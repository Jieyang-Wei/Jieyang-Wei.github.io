<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>fabric-Developing Application | 魏洁杨</title><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"jieyang-wei.github.io",root:"/",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0},style:{primary_color:"#0066CC",avatar:"/images/avatar.jpg",favicon:"/images/logo.svg",img_position:"left",left_side_width:"260px",content_max_width:"900px",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"Welcome to Jieyang Wei's Blog"}},local_search:{enable:!0,trigger:"auto",unescape:!1,preload:!0},version:"3.0.4"},KEEP.language={search:"Search...",prev:"Prev",next:"Next",prev_posts:"Prev posts",next_posts:"Next posts",page:"Page %d",recent_posts:"Recent Posts",share:"Share",powered_by:"Powered by %s",theme:"Theme",rss_feed:"RSS Feed",category:"Category",categories:"Categories",tag:"Tag",tags:"Tags",tagcloud:"Tag Cloud",comment:"Comment",home:"Home",archive:"Archive",archives:"Archives",about:"About",site_uv:"Visitor Count",site_pv:"Totalview",links:"Links",link:"Link",top:"TOP",read_more:"Read more",wordcount:"Words",min2read:"Mins",changelog:"Changelog",copyright:{author:"Post author",title:"Post title",link:"Post link",create_time:"Create time",license_title:"Copyright Notice",license_content:"All articles in this blog are licensed under %s unless stating additionally."},ago:{second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days age",week:"%s weeks age",month:"%s months age",year:"%s years age"}}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="WeiJY's blog" type="application/atom+xml"></head><body><div class="page-container"><header class="page-header"><div class="header-progress"></div></header><main class="page-main"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><a class="logo-title" href="/">魏洁杨</a><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/categories">CATEGORIES</a></li><li class="menu-item"><a href="/categories/notebook">NOTEBOOK</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item"><a href="/tags">TAGS</a></li></ul><div class="menu-bar"><div class="menu-bar-middle"></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/categories">CATEGORIES</a></li><li class="drawer-menu-item flex-center"><a href="/categories/notebook">NOTEBOOK</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><main class="main-content normal-code-theme"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">fabric-Developing Application</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="info"><div class="author"><span>Wei Jieyang</span> <span class="level">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-calendar"></i> 2021-03-16 17:08:51 </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i><ul><li><a href="/categories/Notebook/">Notebook</a></li><li>&gt; <a href="/categories/Notebook/Blockchain/">Blockchain</a></li><li>&gt; <a href="/categories/Notebook/Blockchain/Fabric/">Fabric</a></li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i><ul><li><a href="/tags/fabric/">fabric</a></li><li>| <a href="/tags/blockchain/">blockchain</a></li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i> <span>5.4k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i> <span>24 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i> <span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本部分主要讲解智能合约的部署，已经commercial paper部分的使用和代码解析</p><ol><li><p>end users通过调用智能合约与区块链分类账进行交互。在Hyperledger Fabric中，智能合约部署在称为chaincode的程序包中。想要验证交易或查询分类帐的组织需要在其peer上安装chaincode。在已加入channel的peer上安装 chaincode后，通道成员可以将链码部署到通道，并使用链码中的智能合约在通道分类帐上创建或更新资产。</p></li><li><p>使用称为Fabric chaincode lifecycle的程序将链码部署到通道。Fabric chaincode lifecycle允许多个组织在使用链码创建事务之前就如何操作链码达成共识。例如，虽然背书策略指定哪些组织需要执行链码以验证交易，但渠道成员需要使用Fabric链码生命周期来同意链码背书策略。</p></li></ol><h1 id="应用部署"><a href="#应用部署" class="headerlink" title="应用部署"></a>应用部署</h1><p>使用 fabric-sample 中的示例 <strong>commercial-paper</strong> 和 <strong>asset-transfer-basic</strong> 来进行演示</p><p>首先要先启动测试网络 test-network ，并创建通道 mychannel</p><p>网络中将有两个组织org1和org2（）以及一个排序节点order</p><h2 id="日志监控"><a href="#日志监控" class="headerlink" title="日志监控"></a>日志监控</h2><p>在开始进行完整的商业流程实现之前，需要Logspout工具以便监控过程中所有的日志信息</p><ul><li>启动</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-sample/commercial-paper/organization/digibank/configuration/cli/monitordocker.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./monitordocker.sh fabric_test</span></span><br></pre></td></tr></table></figure><h2 id="chaincode"><a href="#chaincode" class="headerlink" title="chaincode"></a>chaincode</h2><p>设置环境变量，让Org1以admin用户的身份使用 <code>peer</code> 指令操作链码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">&quot;Org1MSP&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_ADDRESS=localhost:7051</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>链码部署过程</strong>：package - install - approveformyorg - commit</p><p><strong>查看部署情况</strong>：queryinstalled - checkcommitreadiness - querycommitted</p></blockquote><h3 id="打包智能合约"><a href="#打包智能合约" class="headerlink" title="打包智能合约"></a>打包智能合约</h3><p>此处以go语言为例，使用目录 <code>fabric-samples/asset-transfer-basic/chaincode-go</code> 下的智能合约</p><ul><li>go.mod：列出合约依赖项<ul><li>将Fabric合约API导入到智能合约包中。</li><li>可以<code>asset-transfer-basic/chaincode-go/chaincode/smartcontract.go</code>在文本编辑器中打开以查看如何<code>SmartContract</code>在智能合约开始时使用合约API定义类型</li></ul></li></ul><ol><li>安装合约依赖关系</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-samples/asset-transfer-basic/chaincode-go</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> GO111MODULE=on go mod vendor</span></span><br></pre></td></tr></table></figure><ol start="2"><li>使用 <code>peer</code> 指令打包所需链码</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="variable">$&#123;PWD&#125;</span>/../../bin:<span class="variable">$PATH</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$PWD</span>/../../config/</span></span><br></pre></td></tr></table></figure><ul><li>主要是指出bin和config两个二进制文件夹所在的位置（fabric-sample目录下）</li><li>根据你的当前位置写路径</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode package basic.tar.gz --path ./ --lang golang --label basic_1.0</span></span><br></pre></td></tr></table></figure><ul><li>参数：<ul><li>basic.tar.gz：打包后的文件名</li><li><strong>–path</strong>：提供智能合约代码的位置<ul><li>当前位置 <code>fabric-sample/asset-transfer-basic/chaincode-go</code> 的相对路径</li></ul></li><li><strong>–lang</strong>：指定链码语言</li><li><strong>–label</strong>：指定一个链码标签，该标签将在安装后识别您的链码。<ul><li>建议您的标签包含链码名称和版本</li></ul></li></ul></li><li>此时已在当前路径下创建了一个链码包（basic.tar.gz），之后可以使用此包安装链码</li></ul><h3 id="部署智能合约到channel"><a href="#部署智能合约到channel" class="headerlink" title="部署智能合约到channel"></a>部署智能合约到channel</h3><h4 id="安装chaincode包"><a href="#安装chaincode包" class="headerlink" title="安装chaincode包"></a>安装chaincode包</h4><ol><li>使用 <code>peer chaincode install</code> 命令在对等方上安装链码</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode install basic.tar.gz</span></span><br></pre></td></tr></table></figure><ul><li>如果命令成功，则对等方将生成并返回包标识符</li><li>此程序包ID将用于批准链码</li></ul><ol start="2"><li>根据fabric的背书策略，链码需要mychannel上认可交易的每个对等方安装链码，所以我们切换 <code>peer</code> 到Org2 admin用户</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置环境变量</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">&quot;Org2MSP&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_ADDRESS=localhost:9051</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装链码包</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode install basic.tar.gz</span></span><br></pre></td></tr></table></figure><h4 id="批准chaincode包"><a href="#批准chaincode包" class="headerlink" title="批准chaincode包"></a>批准chaincode包</h4><p>注意：</p><ul><li>在部署链码之前需要批准链码的一组通道成员受 <code>/Channel/Application/LifecycleEndorsement</code> 策略控制。<ul><li>默认情况下，此策略要求大多数频道成员需要批准链码后才能在频道上使用。因为渠道上只有两个组织，而2个中的大多数是2个，所以我们需要批准资产转移（基本）的链码定义为Org1和Org2。</li></ul></li><li>如果组织已在其对等方上安装了链码，则他们需要在其组织批准的链码定义中包括packageID。程序包ID用于将对等方上安装的链码与批准的链码定义相关联，并允许组织使用链码对交易进行背书。您可以使用对 <code>peer lifecycle chaincode queryinstalled</code> 命令来查询对等节点，从而找到链代码的程序包ID 。</li></ul><ol><li>查询安装的链码包的 <code>PACKEDGE_ID</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode queryinstalled</span></span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: basic_1.0:(一串数字即为package id)</span><br></pre></td></tr></table></figure><ol start="2"><li>先在当前org2组织上批准链码包</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line">$ <span class="built_in">export</span> CC_PACKAGE_ID=basic_1.0:(那串package id的数字)</span><br><span class="line"><span class="comment"># 批准</span></span><br><span class="line">$ peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --package-id <span class="variable">$CC_PACKAGE_ID</span> --sequence 1 --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span></span><br></pre></td></tr></table></figure><ul><li>参数：<ul><li>–tls：是否启动tls</li><li>–cafile：ca证书的路径</li><li>–channelID：智能合约安装的通道名称</li><li>–name：合约名称</li><li>–version：合约版本</li><li><strong>–package-id</strong>：在链码定义中包含程序包标识符</li><li><strong>–sequence</strong>：一个整数，用于跟踪已定义或更新链码的次数<ul><li>由于链码是第一次部署到通道，因此序列号为1。升级链码时，序列号将增加为2。</li><li><strong>–init-required</strong>：如果使用的是提供的低级API通过Fabric Chaincode Shim API，您可以使用此标志传递给上面的命令，以请求执行Init函数来初始化链码。</li><li><strong>–isInit</strong>：链代码的第一次调用需要以Init函数为目标并包括该<code>--isInit</code>标志，然后才能使用链代码中的其他函数与分类帐进行交互。</li></ul></li><li>-<strong>-signature-policy / –channel-config-policy</strong>：指定链码背书策略<ul><li>默认背书策略是需要得到channel上的大多数成员的认可</li></ul></li><li>–waitForEvent：等待peer提交交易返回</li><li>–init-required：合约是否必须执行init</li></ul></li></ul><ol start="3"><li>切换 <code>peer</code> 到Org1 admin用户来批准之前安装的链码包</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">&quot;Org1MSP&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_ADDRESS=localhost:7051</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --package-id <span class="variable">$CC_PACKAGE_ID</span> --sequence 1 --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span></span></span><br></pre></td></tr></table></figure><blockquote><p>虽然只有大多数组织需要批准链码定义（具有默认策略），但是所有组织都需要批准链码定义才能在其对等方启动链码。</p><p>如果您在渠道成员批准链码之前提交定义，则组织将无法批准交易。所以，建议所有通道成员在提交链码定义之前批准链码。</p></blockquote><h4 id="提交链码定义"><a href="#提交链码定义" class="headerlink" title="提交链码定义"></a>提交链码定义</h4><p>在足够多的组织批准了链码定义之后，一个组织可以将链码定义提交给渠道。如果大多数通道成员已批准该定义，则提交事务将成功，并且链码定义中同意的参数将在该通道上实现。</p><ol><li>查看channel成员是否已经批准了此链码</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name basic --version 1.0 --sequence 1 --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span> --output json</span><br></pre></td></tr></table></figure><ul><li><p>此命令标志与批准链码的标志 <code>approveformyorg</code> 相同，所以不需要 <code>--package-id</code> 标志。</p></li><li><p>该命令将生成一个JSON映射，显示通道成员是否批准链码</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;Approvals&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;Org1MSP&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;Org2MSP&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>当多数人都批准了之后，管理员就可以将链码定义提交到channel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --sequence 1 --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span> --peerAddresses localhost:7051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;</span> --peerAddresses localhost:9051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;</span></span></span><br></pre></td></tr></table></figure><ul><li>参数：<ul><li>–tls：是否启动tls</li><li>–channelID：智能合约安装通道</li><li>–name：合约名</li><li>–version：合约版本</li><li>–cafile：ca证书路径</li><li><strong>–peerAddresses</strong>：节点路径，上面标示<code>peer0.org1.example.com</code>从Org1和<code>peer0.org2.example.com</code>Org2进行定位。</li><li><strong>–tlsRootCertFiles</strong>：节点ca根证书路径<ul><li><code>--peerAddresses</code> <code>--tlsRootCertFiles</code> 连用，可多个节点，多个节点即将合约部署到对应节点集合上</li></ul></li><li>–package-id：queryinstalled查询的合约ID</li><li>–sequence：序列号</li><li>–waitForEvent：等待peer提交交易返回</li><li>–init-required：合约是否必须执行init</li></ul></li><li>该<code>commit</code>交易被提交到加入该频道来查询被批准经营的同行组织的chaincode定义的peer。该命令需要针对足够数量的组织中的对等方，以满足部署链码的策略。由于批准是在每个组织内分配的，因此您可以定位属于渠道成员的任何对等方。</li><li>通道成员对链码定义的 <code>approve</code> 将提交给ordering service，以添加到区块中并分发给通道。然后，通道上的对等方将验证是否有足够的组织批准了链码定义。<code>peer lifecycle chaincode commit</code>命令将在返回响应之前等待对等方的验证。</li></ul><ol start="3"><li>确认chaincode定义已提交给channel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode querycommitted --channelID mychannel --name basic --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回 sequence 和 version</span></span><br><span class="line">Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br></pre></td></tr></table></figure><h3 id="调用合约"><a href="#调用合约" class="headerlink" title="调用合约"></a>调用合约</h3><p>fabric智能合约操作主要有 <strong><code>invoke</code></strong> 跟 <strong><code>query</code></strong></p><ol><li>调用链码 <code>InitLedger</code> 方法</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span> -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;</span> --peerAddresses localhost:9051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;</span> -c <span class="string">&#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure><ol start="2"><li>查询集合</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode query -C mychannel -n basic -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure><h3 id="合约升级"><a href="#合约升级" class="headerlink" title="合约升级"></a>合约升级</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode upgrade -o orderer.example.com:7050 --tls --cafile <span class="variable">$ORDERER_CA</span> -C mychannel -n basic -v 1.2 -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;,&quot;c&quot;,&quot;300&quot;]&#125;&#x27;</span> -P <span class="string">&quot;AND (&#x27;Org1MSP.peer&#x27;,&#x27;Org2MSP.peer&#x27;)&quot;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CouchDB"><a href="#CouchDB" class="headerlink" title="CouchDB"></a>CouchDB</h2><p>CouchDB与对等方一起作为独立的数据库进程运行</p><p>需要为每个对等方设置一个CouchDB容器，并通过更改配置文件<code>core.yaml</code>以指向CouchDB容器来更新每个对等方 容器。该<code>core.yaml</code> 文件必须位于环境变量FABRIC_CFG_PATH指定的目录中：</p><ul><li>对于Docker部署，它<code>core.yaml</code>是预先配置的，位于对等容器<code>FABRIC_CFG_PATH</code>文件夹中。但是，在使用Docker环境时，您可以传递环境变量以覆盖core.yaml属性，例如<code>CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS</code>，设置CouchDB地址。</li><li>对于本机二进制部署，<code>core.yaml</code>包含在发布工件分发中。</li></ul><p>编辑的<code>stateDatabase</code>部分<code>core.yaml</code>。指定<code>CouchDB</code>为 <code>stateDatabase</code>并填写关联的<code>couchDBConfig</code>属性。有关更多信息，请参见<a class="link" target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/latest/couchdb_as_state_database.html#couchdb-configuration">CouchDB配置<i class="fas fa-external-link-alt"></i></a>。</p><h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><h3 id="建立通道"><a href="#建立通道" class="headerlink" title="建立通道"></a>建立通道</h3><p>peer create channel</p><h3 id="添加组织到通道"><a href="#添加组织到通道" class="headerlink" title="添加组织到通道"></a>添加组织到通道</h3><h3 id="更新通道配置"><a href="#更新通道配置" class="headerlink" title="更新通道配置"></a>更新通道配置</h3><h1 id="commercial-paper"><a href="#commercial-paper" class="headerlink" title="commercial-paper"></a>commercial-paper</h1><h2 id="启动网络"><a href="#启动网络" class="headerlink" title="启动网络"></a>启动网络</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-samples/commercial-paper</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network-starter.sh</span></span><br></pre></td></tr></table></figure><ul><li>可以使用 <code>docker ps</code> 命令查看本地计算机上运行的Fabric节点</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> commercial-paper/organization/magnetocorp/configuration/cli</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./monitordocker.sh fabric_test &lt;port_number&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在新的窗口下监视 MagnetoCorp 的日志信息</li></ul><h2 id="部署智能合约"><a href="#部署智能合约" class="headerlink" title="部署智能合约"></a>部署智能合约</h2><p>在<code>papercontract</code>被应用程序调用之前，必须将其安装到测试网络的适当对等节点上，然后使用 <code>peer lifecycle</code> 在通道上进行定义。Fabric链码生命周期允许多个组织在将链码部署到通道之前就链码的参数达成一致。因此，我们需要以MagnetoCorp和DigiBank的管理员身份安装和批准链式代码。</p><ol><li>打包智能合约为文件 <code>cp.tar.gz</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> commercial-paper/organization/magnetocorp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> magnetocorp.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode package cp.tar.gz --lang node --path ./contract --label cp_0</span></span><br></pre></td></tr></table></figure><ul><li>在 magnetocorp 的目录下，第二条命令用来设置示例所需的环境变量</li></ul><ol start="2"><li>在channel上安装智能合约</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode install cp.tar.gz</span></span><br></pre></td></tr></table></figure><ol start="3"><li>批准合约</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询package id</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode queryinstalled</span></span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: cp_0:(一串数字即为package id)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置package id环境变量</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PACKAGE_ID=cp_0:(那串package id的数字)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行命令批准合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode approveformyorg --orderer localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name papercontract -v 0 --package-id <span class="variable">$PACKAGE_ID</span> --sequence 1 --tls --cafile <span class="variable">$ORDERER_CA</span></span></span><br></pre></td></tr></table></figure><ol start="4"><li>再以 DigiBank 的身份部署合约</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打包合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> commercial-paper/organization/digibank/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> digibank.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode package cp.tar.gz --lang node --path ./contract --label cp_0</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode install cp.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询设置package id</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode queryinstalled</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PACKAGE_ID=cp_0:...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 批准合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode approveformyorg --orderer localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name papercontract -v 0 --package-id <span class="variable">$PACKAGE_ID</span> --sequence 1 --tls --cafile <span class="variable">$ORDERER_CA</span></span></span><br></pre></td></tr></table></figure><h2 id="提交链码到channel"><a href="#提交链码到channel" class="headerlink" title="提交链码到channel"></a>提交链码到channel</h2><ol><li>查看通道上 approve 的情况，是否满足 commit 的条件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name papercontract --version 0 --sequence 1</span></span><br></pre></td></tr></table></figure><ol start="2"><li>当 MagnetoCorp 和 DigiBank 均批准了链码之后，我们就可以提交链码定义了</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --peerAddresses localhost:7051 --tlsRootCertFiles <span class="variable">$&#123;PEER0_ORG1_CA&#125;</span> --peerAddresses localhost:9051 --tlsRootCertFiles <span class="variable">$&#123;PEER0_ORG2_CA&#125;</span> --channelID mychannel --name papercontract -v 0 --sequence 1 --tls --cafile <span class="variable">$ORDERER_CA</span> --waitForEvent</span></span><br></pre></td></tr></table></figure><ol start="3"><li>查看提交的链码</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 查看通道 mychannel 上安装了哪些链码</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode querycommitted -C mychannel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出：</span></span><br><span class="line">Committed chaincode definitions on channel &#x27;mychannel&#x27;:</span><br><span class="line">Name: papercontract, Version: 0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查看通道 mychannel 上安装的链码 papercontract 的详情</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode querycommitted -C mychannel --name papercontract</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出：</span></span><br><span class="line">Committed chaincode definition for chaincode &#x27;papercontract&#x27; on channel &#x27;mychannel&#x27;:</span><br><span class="line">Version: 0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br></pre></td></tr></table></figure><ul><li>-C / –channelID：通道名称</li><li>–name：链码名称</li></ul><h2 id="更新链码"><a href="#更新链码" class="headerlink" title="更新链码"></a>更新链码</h2><p>在fabric2.0新增的命令<code>peer lifecycle chaincode</code>下，链码更新的步骤和部署链码的步骤相同。</p><ul><li>sequence：版本，表示这是本链码的第几个版本</li><li>version：版本号，表示本链码此版本的版本号</li><li>比如下面演示部分就是将链码更新为版本号为1的第二个版本</li></ul><ol><li>打包成版本 1.0</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> commercial-paper/organization/magnetocorp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> magnetocorp.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode package cp.tar.gz --lang node --path ./contract --label cp_1</span></span><br></pre></td></tr></table></figure><ol start="2"><li>安装链码 1.0 版本</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode install cp.tar.gz</span></span><br></pre></td></tr></table></figure><ol start="3"><li>批准链码</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询package id</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode queryinstalled</span></span><br><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: cp_1:(一串数字即为package id)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置package id环境变量</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PACKAGE_ID=cp_1:(那串package id的数字)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行命令批准合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode approveformyorg --orderer localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name papercontract -v 1 --package-id <span class="variable">$PACKAGE_ID</span> --sequence 2 --tls --cafile <span class="variable">$ORDERER_CA</span></span></span><br></pre></td></tr></table></figure><blockquote><p><strong>注意</strong>，此处版本号为1，因为是第二个版本，所以 sequence 为2</p></blockquote><ol start="4"><li>如果要在 DigiBank 上也更新的话，需要执行相同的流程</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打包合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> commercial-paper/organization/digibank/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> digibank.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode package cp.tar.gz --lang node --path ./contract --label cp_1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode install cp.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询设置package id</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode queryinstalled</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PACKAGE_ID=cp_1:...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 批准合约</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode approveformyorg --orderer localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name papercontract -v 1 --package-id <span class="variable">$PACKAGE_ID</span> --sequence 2 --tls --cafile <span class="variable">$ORDERER_CA</span></span></span><br></pre></td></tr></table></figure><ol start="5"><li>提及更新后的链码<ul><li>只有下载并提交了新链码的peer才能使用<strong>新链码</strong>，否则依然使用<strong>旧链码</strong></li></ul></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 approve 的情况</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name papercontract --version 1 --sequence 2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --peerAddresses localhost:7051 --tlsRootCertFiles <span class="variable">$&#123;PEER0_ORG1_CA&#125;</span> --peerAddresses localhost:9051 --tlsRootCertFiles <span class="variable">$&#123;PEER0_ORG2_CA&#125;</span> --channelID mychannel --name papercontract -v 1 --sequence 2 --tls --cafile <span class="variable">$ORDERER_CA</span> --waitForEvent</span></span><br></pre></td></tr></table></figure><ol start="6"><li>之后调用链码 <code>papercontract</code>时便是使用的更新后的版本</li></ol><h2 id="应用结构及代码"><a href="#应用结构及代码" class="headerlink" title="应用结构及代码"></a>应用结构及代码</h2><blockquote><p>每次运行 Application 前，都需要删除 identity 文件夹，清除上次运行分发的身份，重新enroll当前网络</p></blockquote><h3 id="MagnetoCorp"><a href="#MagnetoCorp" class="headerlink" title="MagnetoCorp"></a>MagnetoCorp</h3><p>目录：<code>fabric-samples/commercial-paper/organization/magnetocorp/application</code></p><ol><li>安装依赖</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><ol start="2"><li>注册用户，生成用户钱包</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node enrollUser.js</span></span><br></pre></td></tr></table></figure><ol start="2"><li>发行commercial paper</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node issue.js</span></span><br></pre></td></tr></table></figure><h3 id="DigiBank"><a href="#DigiBank" class="headerlink" title="DigiBank"></a>DigiBank</h3><p>目录：<code>fabric-samples/commercial-paper/organization/digibank/application</code></p><ol><li>安装依赖</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><ol start="2"><li>注册用户，生成用户钱包</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node enrollUser.js</span></span><br></pre></td></tr></table></figure><ol start="3"><li>购买commercial paper</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node buy.js</span></span><br></pre></td></tr></table></figure><ol start="4"><li>赎回</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node reedem.js</span></span><br></pre></td></tr></table></figure><h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>应用程序<strong>提交交易</strong>步骤：</p><ul><li>（前提是用户已经加入到网络中，拥有了一个身份）</li><li>从钱包中选择一个身份</li><li>连接到网关</li><li>访问所需的网络</li><li>构建智能合约的交易请求</li><li>将交易提交到网络</li><li>处理回应</li></ul><p><strong>代码框架</strong>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; Wallets, Gateway &#125; = <span class="built_in">require</span>(<span class="string">&#x27;fabric-network&#x27;</span>);</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	  <span class="comment">// 得到钱包</span></span><br><span class="line">    <span class="keyword">const</span> wallet = <span class="keyword">await</span> Wallets.newFileSystemWallet(<span class="string">&#x27;../identity/user/isabella/wallet&#x27;</span>);</span><br><span class="line">    <span class="comment">// 接入网关</span></span><br><span class="line">		<span class="keyword">const</span> gateway = <span class="keyword">new</span> Gateway();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> userName = <span class="string">&#x27;isabella.issuer@magnetocorp.com&#x27;</span>;</span><br><span class="line">        <span class="keyword">let</span> connectionProfile = yaml.safeLoad(fs.readFileSync(<span class="string">&#x27;../gateway/connection-org2.yaml&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>));</span><br><span class="line">        <span class="keyword">let</span> connectionOptions = &#123;</span><br><span class="line">		  		  identity: userName,</span><br><span class="line">		  	   	wallet: wallet,</span><br><span class="line">			  	  discovery: &#123; <span class="attr">enabled</span>:<span class="literal">true</span>, <span class="attr">asLocalhost</span>: <span class="literal">true</span> &#125;</span><br><span class="line">	  	  &#125;;</span><br><span class="line">	  	  <span class="keyword">await</span> gateway.connect(connectionProfile, connectionOptions); </span><br><span class="line">        ...</span><br><span class="line">	  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>Wallet</strong><ul><li>钱包包含一组身份（X.509数字证书），可用于访问PaperNet或任何其他Fabric网络</li></ul></li></ol><ol start="2"><li><p><strong>Gateway</strong></p><ul><li><p>网关标识一个或多个对等网络，这些对等网络提供对网络的访问权限 - 示例中的PaperNet</p></li><li><p>负责使用<strong>连接配置文件</strong>和<strong>连接选项</strong>将交易建议发送到网络中正确的对等节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> gateway.connect(connectionProfile, connectionOptions); </span><br></pre></td></tr></table></figure><ul><li><p><strong>connectionProfile</strong>：<strong>连接配置文件</strong>的系统位置，该配置文件将一组对等方标识为PaperNet的网关</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载并转换为JSON对象</span></span><br><span class="line"><span class="keyword">let</span> connectionProfile = yaml.safeLoad(fs.readFileSync(<span class="string">&#x27;../gateway/connection-org2.yaml&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>));</span><br></pre></td></tr></table></figure></li><li><p><strong>connectionOptions</strong>：用于控制 <code>issue.js</code> 与PaperNet<strong>交互方式</strong>的一组选项</p></li></ul></li></ul></li></ol><h3 id="Contract"><a href="#Contract" class="headerlink" title="Contract"></a>Contract</h3><p>目录结构：</p><img src="/2021/03/16/fabric-Developing%20Application/截屏2021-03-18 下午6.21.17.png" alt="截屏2021-03-18 下午6.21.17" style="zoom:50%"><ul><li><p>lib：主要的paper相关操作</p><ul><li><p><strong>paper.js</strong>：定义 commercial paper 相关属性的set、get、is…和相关静态方法（序列化、反序列化等）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommercialPaper</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>papercontract.js</strong>：定义了交易逻辑（此处包括issue、buy、redeem、transfer等）</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommercialPaperContext</span> <span class="keyword">extends</span> <span class="title">Context</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommercialPaperContract</span> <span class="keyword">extends</span> <span class="title">Contract</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li>CommercialPaperContext：创建并维护 paperList，用来定位到所需操作的paper</li><li>CommercialPaperContract：定义交易主要逻辑，在交易中完成paper的状态转移</li></ul></li><li><p><strong>paperlist.js</strong>：维护 paperList 相关的方法 - add、get、update</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaperList</span> <span class="keyword">extends</span> <span class="title">StateList</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ledger-api：</p><ul><li><p><strong>state.js</strong>：主要控制 paper 的 stateClass 和 keyParts</p></li><li><p><strong>statelist.js</strong>：根据paper的state和key来控制paperlist的状态，并调用fabric-contract-api与区块链交互</p><blockquote><p>该类不存储任何单个状态或者状态列表，而是委派给Fabric数据库</p><ul><li>这是一种重要的设计模式–减少了Hyperledger Fabric中分类账<strong>MVCC冲突</strong>的机会。</li></ul></blockquote><ul><li><pre><code class="javascript">async addState(state) &#123;
    let key = this.ctx.stub.createCompositeKey(this.name, state.getSplitKey());
    let data = State.serialize(state);
    await this.ctx.stub.putState(key, data);
&#125;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  * **分类账**：每个状态数据都需要以下两个基本元素</span><br><span class="line"></span><br><span class="line">    1. **密钥**：&#96;key&#96; 是 &#96;createCompositeKey()&#96; 使用固定名称和 &#96;state&#96; 的密钥形成的。</span><br><span class="line">       * &#96;this.name&#96; 是在 &#96;PaperList&#96; 构造对象时分配的</span><br><span class="line">       * &#96;state.getSplitKey()&#96;确定每个状态的唯一键。</span><br><span class="line">    2. **数据**：&#96;data &#96;只是使用 &#96;State.serialize()&#96; 实用程序方法创建的commercial paper状态的序列化形式。</span><br><span class="line">       *  &#96;State&#96; 类使用JSON来序列化和反序列化数据，state的对象类需要，在我们的例子&#96;CommercialPaper&#96;中， &#96;PaperList&#96; 对象构建时需要重定义。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># fabcar</span><br><span class="line"></span><br><span class="line">提供了Fabric功能的广泛演示</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"># 代码工具</span><br><span class="line"></span><br><span class="line">[工具使用](http:&#x2F;&#x2F;cw.hubwiz.com&#x2F;card&#x2F;c&#x2F;fabric-command-manual&#x2F;1&#x2F;1&#x2F;27&#x2F;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## peer</span><br><span class="line"></span><br><span class="line">[汇智网命令大全](http:&#x2F;&#x2F;cw.hubwiz.com&#x2F;card&#x2F;c&#x2F;fabric-command-manual&#x2F;1&#x2F;1&#x2F;1&#x2F;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">有以下5个子命令</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;shell</span><br><span class="line">$ peer chaincode [option] [flags]</span><br><span class="line">$ peer channel   [option] [flags]</span><br><span class="line">$ peer logging   [option] [flags]</span><br><span class="line">$ peer node      [option] [flags]</span><br><span class="line">$ peer version   [option] [flags]</span><br></pre></td></tr></table></figure>


</code></pre></li></ul></li></ul></li></ul><p>**通用 [flag]**：</p><ul><li><strong>–cafile</strong> string<ul><li>Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint</li><li>包含用于订购端点的PEM编码的受信任证书的文件的路径</li></ul></li><li><strong>–certfile</strong> string<ul><li>Path to file containing PEM-encoded X509 public key to use for mutual TLS communication with the orderer endpoint</li><li>包含用于与订购者端点进行相互TLS通信的PEM编码X509公钥的文件的路径</li></ul></li><li><strong>–clientauth</strong><ul><li>Use mutual TLS when communicating with the orderer endpoint</li></ul></li><li><strong>–connTimeout duration</strong><ul><li>Timeout for client to connect (default 3s)</li></ul></li><li><strong>-h, –help</strong><ul><li>help for channel</li></ul></li><li><strong>–keyfile</strong> string<ul><li>Path to file containing PEM-encoded private key to use for mutual TLS communication with the orderer endpoint</li><li>包含用于与订购者端点进行相互TLS通信的PEM编码的私钥的文件的路径</li></ul></li><li><strong>-o, –orderer</strong> string<ul><li>Ordering service endpoint</li><li>订购服务端点指定为 <code>&lt;hostname or IP address&gt;:&lt;port&gt;</code></li></ul></li><li><strong>–ordererTLSHostnameOverride</strong> string<ul><li>The hostname override to use when validating the TLS connection to the orderer.</li><li>验证与订购者的TLS连接时要使用的主机名覆盖</li></ul></li><li><strong>–tls</strong><ul><li>Use TLS when communicating with the orderer endpoint</li><li>与订购者端点进行通信时使用TLS</li></ul></li><li><strong>–transient</strong> string<ul><li>JSON编码中的参数的瞬时映射</li></ul></li></ul><h3 id="peer-chaincode"><a href="#peer-chaincode" class="headerlink" title="peer chaincode"></a>peer chaincode</h3><p><code>peer chaincode invoke</code></p><p><code>peer chaincode query</code></p><p><code>peer chaincode install</code></p><p><code>peer chaincode instantiate</code></p><p><code>peer chaincode list</code></p><p><code>peer chaincode package</code></p><p><code>peer chaincode signpackage</code></p><p><code>peer chaincode upgrade</code></p><h3 id="peer-channel"><a href="#peer-channel" class="headerlink" title="peer channel"></a>peer channel</h3><p>peer channel list：列出当前组织所属的所有通道列表</p><h3 id="peer-lifecycle-chaincode"><a href="#peer-lifecycle-chaincode" class="headerlink" title="peer lifecycle chaincode"></a>peer lifecycle chaincode</h3><p>包含以下<strong>子命令</strong>:</p><ul><li><p>package： 打包链码<br>*</p></li><li><p>install： 安装链码<br>*</p></li><li><p>queryinstalled： 查询指定peer节点上已经安装的链码</p><ul><li></li></ul></li><li><p>approveformyorg： 批准链码定义<br>*</p></li><li><p>checkcommitreadiness： 检查链码是否可以向通道提交<br>*</p></li><li><p>commit： 向通道提交链码定义<br>*</p></li><li><p>querycommitted： 按通道查询已经提交的链码定义<br>*</p></li><li><p>getinstalledpackage： 从peer节点获取已经安装的链码包</p><ul><li></li></ul></li></ul><p>可用<strong>标志</strong>:</p><ul><li>–cafile string PEM编码的CA证书文件路径</li><li>–certfile string 双向TLS通讯所需的PEM编码的X509证书文件路径</li><li>–clientauth 与排序节点的通讯是否启用双向TLS</li><li>–connTimeout duration 客户端连接超时，默认值：3秒</li><li>-h, –help 帮助信息</li><li>–keyfile string 双向TLS通讯所需的PEM编码的私钥文件</li><li>-o, –orderer string 排序节点地址</li><li>–ordererTLSHostnameOverride string 验证TLS连接时使用的排序节点主机名</li><li>–tls 与排序节点通信时是否启用TLS</li></ul></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>Post title：fabric-Developing Application</li><li>Post author：Wei Jieyang</li><li>Create time：2021-03-16 17:08:51</li><li>Post link：https://jieyang-wei.github.io/2021/03/16/fabric-Developing Application/</li><li>Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2021/03/19/fabric-Tutorials/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">fabric-Tutorials</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2021/03/14/fabric-Getting%20Start/"><span class="title flex-center"><span class="post-nav-title-item">fabric-Getting Start</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div></main></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span> - 2021 <i class="fas fa-heart icon-animate"></i> <a href="/">Wei Jieyang</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"><span id="busuanzi_container_site_uv">Visitor Count <span id="busuanzi_value_site_uv"></span>&ensp; </span><span id="busuanzi_container_site_pv">Totalview <span id="busuanzi_value_site_pv"></span></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme <a class="theme-version" target="_blank"></a></div></div></footer></div></div></main><div class="sidebar-tools"><div class="tools-container"><ul class="tools-list"><li class="search popup-trigger"><i class="fas fa-search"></i></li><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="tools-ul-1"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">2.</span> <span class="nav-text">应用部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7"><span class="nav-number">2.1.</span> <span class="nav-text">日志监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#chaincode"><span class="nav-number">2.2.</span> <span class="nav-text">chaincode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8C%85%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="nav-number">2.2.1.</span> <span class="nav-text">打包智能合约</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0channel"><span class="nav-number">2.2.2.</span> <span class="nav-text">部署智能合约到channel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85chaincode%E5%8C%85"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">安装chaincode包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%B9%E5%87%86chaincode%E5%8C%85"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">批准chaincode包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E9%93%BE%E7%A0%81%E5%AE%9A%E4%B9%89"><span class="nav-number">2.2.2.3.</span> <span class="nav-text">提交链码定义</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6"><span class="nav-number">2.2.3.</span> <span class="nav-text">调用合约</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E7%BA%A6%E5%8D%87%E7%BA%A7"><span class="nav-number">2.2.4.</span> <span class="nav-text">合约升级</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CouchDB"><span class="nav-number">2.3.</span> <span class="nav-text">CouchDB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Channel"><span class="nav-number">2.4.</span> <span class="nav-text">Channel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E9%80%9A%E9%81%93"><span class="nav-number">2.4.1.</span> <span class="nav-text">建立通道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%BB%84%E7%BB%87%E5%88%B0%E9%80%9A%E9%81%93"><span class="nav-number">2.4.2.</span> <span class="nav-text">添加组织到通道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E9%80%9A%E9%81%93%E9%85%8D%E7%BD%AE"><span class="nav-number">2.4.3.</span> <span class="nav-text">更新通道配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#commercial-paper"><span class="nav-number">3.</span> <span class="nav-text">commercial-paper</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E7%BD%91%E7%BB%9C"><span class="nav-number">3.1.</span> <span class="nav-text">启动网络</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="nav-number">3.2.</span> <span class="nav-text">部署智能合约</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E9%93%BE%E7%A0%81%E5%88%B0channel"><span class="nav-number">3.3.</span> <span class="nav-text">提交链码到channel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E9%93%BE%E7%A0%81"><span class="nav-number">3.4.</span> <span class="nav-text">更新链码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%BB%93%E6%9E%84%E5%8F%8A%E4%BB%A3%E7%A0%81"><span class="nav-number">3.5.</span> <span class="nav-text">应用结构及代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MagnetoCorp"><span class="nav-number">3.5.1.</span> <span class="nav-text">MagnetoCorp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DigiBank"><span class="nav-number">3.5.2.</span> <span class="nav-text">DigiBank</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Application"><span class="nav-number">3.5.3.</span> <span class="nav-text">Application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Contract"><span class="nav-number">3.5.4.</span> <span class="nav-text">Contract</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#peer-chaincode"><span class="nav-number">3.5.5.</span> <span class="nav-text">peer chaincode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#peer-channel"><span class="nav-number">3.5.6.</span> <span class="nav-text">peer channel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#peer-lifecycle-chaincode"><span class="nav-number">3.5.7.</span> <span class="nav-text">peer lifecycle chaincode</span></a></li></ol></li></ol></li></ol></div></div></aside><div class="image-viewer-container"><div class="img-box"><img src=""></div></div></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fas fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/code-copy.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/toc.js"></script></body></html>