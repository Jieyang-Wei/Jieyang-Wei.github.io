<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>fabric-Getting Start | 魏洁杨</title><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"jieyang-wei.github.io",root:"/",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0},style:{primary_color:"#0066CC",avatar:"/images/avatar.jpg",favicon:"/images/logo.svg",img_position:"left",left_side_width:"260px",content_max_width:"900px",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"Welcome to Wei jieyang's Blog"}},local_search:{enable:!0,trigger:"auto",unescape:!1,preload:!0},version:"3.0.4"},KEEP.language={search:"Search...",prev:"Prev",next:"Next",prev_posts:"Prev posts",next_posts:"Next posts",page:"Page %d",recent_posts:"Recent Posts",share:"Share",powered_by:"Powered by %s",theme:"Theme",rss_feed:"RSS Feed",category:"Category",categories:"Categories",tag:"Tag",tags:"Tags",tagcloud:"Tag Cloud",comment:"Comment",home:"Home",archive:"Archive",archives:"Archives",about:"About",site_uv:"Visitor Count",site_pv:"Totalview",links:"Links",link:"Link",top:"TOP",read_more:"Read more",wordcount:"Words",min2read:"Mins",changelog:"Changelog",copyright:{author:"Post author",title:"Post title",link:"Post link",create_time:"Create time",license_title:"Copyright Notice",license_content:"All articles in this blog are licensed under %s unless stating additionally."},ago:{second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days age",week:"%s weeks age",month:"%s months age",year:"%s years age"}}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="WeiJY's blog" type="application/atom+xml"></head><body><div class="page-container"><header class="page-header"><div class="header-progress"></div></header><main class="page-main"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><a class="logo-title" href="/">魏洁杨</a><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/categories">CATEGORIES</a></li><li class="menu-item"><a href="/categories/notebook">NOTEBOOK</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item"><a href="/tags">TAGS</a></li></ul><div class="menu-bar"><div class="menu-bar-middle"></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/categories">CATEGORIES</a></li><li class="drawer-menu-item flex-center"><a href="/categories/notebook">NOTEBOOK</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><main class="main-content normal-code-theme"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">fabric-Getting Start</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="info"><div class="author"><span>Wei Jieyang</span> <span class="level">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-calendar"></i> 2021-03-14 12:08:44 </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i><ul><li><a href="/categories/notebook/">notebook</a></li><li>&gt; <a href="/categories/notebook/blockchain/">blockchain</a></li><li>&gt; <a href="/categories/notebook/blockchain/fabric/">fabric</a></li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i><ul><li><a href="/tags/fabric/">fabric</a></li><li>| <a href="/tags/blockchain/">blockchain</a></li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i> <span>5k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i> <span>21 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i> <span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本部分主要设计fabric环境安装，已经 <code>fabric-sample</code> 中 <code>test-network</code> 和 <code>asset-transfer-basic</code> 样例的运行</p><p>Fabric应用程序堆栈有五层：</p><img src="/2021/03/14/fabric-Getting%20Start/getting_started_image2.png" alt="织物应用堆栈" style="zoom:20%"><ul><li>必备软件：运行该软件所需的基础层，例如Docker。</li><li>Fabric和Fabric示例：Fabric可执行文件与示例代码一起运行Fabric网络。</li><li>合约API：开发在Fabric网络上执行的智能合约。</li><li>应用程序SDK：开发您的区块链应用程序。</li><li>应用程序：您的区块链应用程序将利用应用程序SDK调用在Fabric网络上运行的智能合约。</li></ul><p><strong>fabric核心模块</strong></p><table><thead><tr><th align="center">模块名词</th><th align="center">功能</th><th align="center">类型</th></tr></thead><tbody><tr><td align="center">peer</td><td align="center">主节点模块，负责存储区块链数据，运行维护代码</td><td align="center">系统模块</td></tr><tr><td align="center">order</td><td align="center">交易打包，排序模块</td><td align="center">系统模块</td></tr><tr><td align="center">cryptogen</td><td align="center">组织和证书生成模块</td><td align="center">工具模块</td></tr><tr><td align="center">configtxgen</td><td align="center">区块和交易生成模块</td><td align="center">工具模块</td></tr><tr><td align="center">configtxlator</td><td align="center">区块和交易解析模块</td><td align="center">工具模块</td></tr></tbody></table><ul><li>工具模块负责证书文件，区块链创始块，通道创始块等相关文件和证书的生成工作，不参与系统的运行。</li><li><strong>cryptogen</strong>：模块主要用于生成组织结构和账号相关文件，任何fabric系统的开发都是从cryptogen模块开始，在系统设计完成后首要工作就是根据系统设计编写cryptogen的配置文件。</li></ul><h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><p><a class="link" target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/latest/getting_started.html">官方文档<i class="fas fa-external-link-alt"></i></a></p><p>系统：MacOS</p><h2 id="必备软件"><a href="#必备软件" class="headerlink" title="必备软件"></a>必备软件</h2><p>Prerequisites - 先决条件</p><ul><li><strong>Homebrew</strong>：仅mac系统需要，用来管理下面所需要的软件包</li><li><strong>git</strong>：<strong>版本管理</strong>工具</li><li><strong>cURL</strong>：curl命令是个功能强大的<strong>网络工具</strong>，支持通过http、ftp等方式下载文件、上传文件</li><li><strong>Docker &amp; Docker-compose</strong>：一个开源的<strong>应用容器引擎</strong>，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化</li><li><strong>Go</strong>：Docker是基于go语言的<ul><li>(only required if you will be writing Go chaincode or SDK applications)</li></ul></li><li><strong>JQ</strong>：既JQuery，一个优秀的javascript类库<ul><li>(only required for the tutorials related to channel configuration transactions)</li></ul></li></ul><h3 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> /bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)</span>&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew --version</span></span><br><span class="line">Homebrew 3.0.4</span><br><span class="line">Homebrew/homebrew-core (git revision 89d933; last commit 2020-04-01)</span><br></pre></td></tr></table></figure><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><blockquote><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-07 下午5.22.32.png" alt="截屏2021-03-07 下午5.22.32" style="zoom:50%"><ol><li>Error: Unknown command: cask<ul><li>Homebrew 2.5.x 之后删掉了<code>brew cask</code></li><li>直接使用<code>brew</code>，或者<code>brew --cask</code>即可</li></ul></li></ol><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-07 下午5.21.56.png" alt="截屏2021-03-07 下午5.21.56" style="zoom:50%"><ol start="2"><li><p>升级后核心不可用<code>homebrew-core is a shallow clone</code></p><ul><li>先按照提示执行<code>git -C /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core fetch --unshallow</code></li></ul><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-07 下午7.57.58.png" alt="截屏2021-03-07 下午7.57.58" style="zoom:50%"><ul><li>如果系统不支持<code>unshallow</code>，则删掉核心后再update</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rm -rf /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew update</span></span><br></pre></td></tr></table></figure></li></ol></blockquote><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git --version</span></span><br><span class="line">git version 2.24.3 (Apple Git-128)</span><br></pre></td></tr></table></figure><h3 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a>cURL</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install curl</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl --version</span></span><br><span class="line">curl 7.63.0 (x86_64-apple-darwin13.4.0) libcurl/7.63.0 OpenSSL/1.1.1b zlib/1.2.11 libssh2/1.8.0</span><br><span class="line">Release-Date: 2018-12-12</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul><li>Since Docker Desktop is a UI application on Mac, use <code>cask</code> to install it.</li></ul><p>Homebrew v2.x:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew cask install --appdir=<span class="string">&quot;/Applications&quot;</span> docker</span></span><br></pre></td></tr></table></figure><p>Homebrew v3.x:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install --cask --appdir=<span class="string">&quot;/Applications&quot;</span> docker</span></span><br></pre></td></tr></table></figure><ul><li>Docker Desktop must be launched to complete the installation so be sure to open the application after installing it:</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> open /Applications/Docker.app</span></span><br></pre></td></tr></table></figure><ul><li>Once installed, confirm the latest versions of both <code>docker</code> and <code>docker-compose</code> executables were installed.</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker --version</span></span><br><span class="line">Docker version 20.10.5, build 55c4c88</span><br><span class="line"><span class="meta">$</span><span class="bash"> docker-compose --version</span></span><br><span class="line">docker-compose version 1.28.5, build c4eb3a1f</span><br></pre></td></tr></table></figure><h4 id="加速"><a href="#加速" class="headerlink" title="加速"></a>加速</h4><ul><li><p>docker镜像在国外，为了后续下载加速，配置文件将镜像换成国内的</p><ul><li><p>在<code>/etc/docker/daemon.json</code>文件中配置或者如下图所示在软件中配置：</p></li><li><p><code>&#123;&quot;registry-mirrors&quot;:[&quot;https://reg-mirror.qiniu.com/&quot;]&#125;</code></p><p>![截屏2021-03-07 下午9.55.31](fabric-Getting Start/截屏2021-03-07 下午9.55.31.png)</p></li></ul></li></ul><h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install go</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go version</span></span><br><span class="line">go version go1.16 darwin/amd64</span><br></pre></td></tr></table></figure><ul><li>可以根据喜好设置项目目录，下面为推荐目录结构</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> GOPATH:<span class="variable">$Home</span>/&lt;user-defined-workspace&gt;/go</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go env GOPATH</span></span><br><span class="line">/Users/weijieyang/go</span><br></pre></td></tr></table></figure><h3 id="JQ"><a href="#JQ" class="headerlink" title="JQ"></a>JQ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install jq</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> jq --version</span></span><br><span class="line">jq-1.6</span><br></pre></td></tr></table></figure><h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><blockquote><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-08 下午1.26.23.png" alt="截屏2021-03-08 下午1.26.23" style="zoom:50%"><ol><li>python版本问题<ul><li>按照给出的指令顺序操作</li><li><code>--overwrite</code> 表示强制</li></ul></li></ol><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-08 下午1.32.00.png" alt="截屏2021-03-08 下午1.32.00" style="zoom:50%"></blockquote><h2 id="fabric-sample"><a href="#fabric-sample" class="headerlink" title="fabric-sample"></a>fabric-sample</h2><p>github源码：</p><ul><li><p><a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric.git">fabric<i class="fas fa-external-link-alt"></i></a></p></li><li><p><a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-samples.git">fabric-samples<i class="fas fa-external-link-alt"></i></a></p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p <span class="variable">$HOME</span>/go/src/github.com/&lt;your_github_userid&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$HOME</span>/go/src/github.com/&lt;your_github_userid&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -sSL https://bit.ly/2ysbOFE | bash -s</span></span><br></pre></td></tr></table></figure><ul><li>创建go项目目录并使用curl下载sample文件</li></ul><ul><li><p>上面的curl命令将会执行以下步骤：</p><ol><li><p>克隆<a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-samples.git">hyperledger / fabric-samples<i class="fas fa-external-link-alt"></i></a>存储库。</p></li><li><p>下载最新的Hyperledger Fabric Docker映像并将其标记为 <code>latest</code></p></li><li><p>将以下特定于平台<strong>编译好的</strong>的Hyperledger Fabric CLI工具<strong>二进制文件</strong>和<strong>配置文件</strong>下载到<code>fabric-samples</code> <code>/bin</code>和<code>/config</code>目录中。这些二进制文件将帮助您与测试网络进行交互。</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-09 下午10.05.11.png" alt="截屏2021-03-09 下午10.05.11" style="zoom:50%"></li></ol></li></ul><h3 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h3><blockquote><p><strong>报错</strong>：</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-08 下午8.49.03.png" alt="截屏2021-03-08 下午8.49.03" style="zoom:50%"><ul><li>此处网站 <code>https://bit.ly/2ysbOFE</code> 需要科学上网，在国内访问不了</li></ul><p>（针对Ubuntu / CentOS系统）</p><ol><li><p>如果无法访问上述github文件，可以考虑添加docker镜像源</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-08 下午9.29.57.png" alt="截屏2021-03-08 下午9.29.57" style="zoom:50%"><ul><li><p>在文件 <code>/etc/docker/daemon.json</code> 中添加镜像源：</p><p><code>&quot;registry-mirrors&quot;:[&quot;https://registry.docker-cn.com&quot;]</code></p></li><li><p>查看镜像源：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker info|grep Mirrors -A 1</span></span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https://registry.docker-cn.com/</span><br></pre></td></tr></table></figure></li><li><p>重启网络</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Ubuntu</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/networking restart</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CentOS</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo /etc/init.d/network restart</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Mac</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ifconfig en0 down/up</span></span><br></pre></td></tr></table></figure></li><li><p>再次执行curl指令</p></li></ul></li></ol><p>（还是无法链接网站）</p><ol start="2"><li>上面的网站主要是为了获得一个<code>bootstrap.sh</code>的脚本文件并执行</li></ol><ul><li><p>我们只需要去fabric中下载<a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric/blob/master/scripts/bootstrap.sh">bootstrap.sh源码<i class="fas fa-external-link-alt"></i></a>即可</p><ul><li>需要先下载zip <code>https://github.com/hyperledger/fabric.git</code> (master分支)</li><li>再将文件<code>fabric/scripts/bootstrap.sh</code> 移动到目录<code>$HOME/go/src/github.com/&lt;your_github_userid&gt;</code>下</li><li>或者使用github单个文件下载工具<a class="link" target="_blank" rel="noopener" href="https://minhaskamal.github.io/DownGit/#/home">DownGit<i class="fas fa-external-link-alt"></i></a></li><li>之后在此脚本目录下执行下面的指令即可</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat bootstrap.sh |bash -s</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意文件版本，根据自己的系统选择，darwin（=MacOS）、linux、win等</p></blockquote><ul><li><p>运行 bootstrap.sh 时如果发现无法下载fabric的<strong>二进制可执行文件</strong>和<strong>配置文件</strong>，如下图：</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-09 下午3.39.33.png" alt="截屏2021-03-09 下午3.39.33" style="zoom:50%"><ul><li><p>可能是因为网络不稳定，换一个好点的网络重新运行</p></li><li><p>也可以将这部分的代码单独拉出来执行</p><ol><li><p>点击下面两个链接即可自动下载</p><ul><li><a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric/releases/download/v2.3.1/hyperledger-fabric-darwin-amd64-2.3.1.tar.gz">fabric-darwin-amd64-2.3.1.tar.gz<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-ca/releases/download/v1.4.9/hyperledger-fabric-ca-darwin-amd64-1.4.9.tar.gz">fabric-ca-darwin-amd64-1.4.9.tar.gz<i class="fas fa-external-link-alt"></i></a></li></ul></li><li><p>或者在终端中执行下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 失败重复5次，重复间隔时间为3s，并保存为 .tar.gz 形式</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -L --retry 5 --retry-delay 3 <span class="string">&quot;https://github.com/hyperledger/fabric/releases/download/v2.3.1/hyperledger-fabric-darwin-amd64-2.3.1.tar.gz&quot;</span> | tar xz</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -L --retry 5 --retry-delay 3 <span class="string">&quot;https://github.com/hyperledger/fabric-ca/releases/download/v1.4.9/hyperledger-fabric-ca-darwin-amd64-1.4.9.tar.gz&quot;</span> | tar xz</span></span><br></pre></td></tr></table></figure></li><li><p>或者自行编译<a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric.git">fabric<i class="fas fa-external-link-alt"></i></a>和<a class="link" target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-ca.git">fabric-ca<i class="fas fa-external-link-alt"></i></a>源码得到，需要go环境依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编译fabric</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make release</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/hyperledger/fabric/release/linux-amd64/bin/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译fabric-ca</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-ca</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make fabric-ca-server</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make fabric-ca-client</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> bin</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>解压后得到两个bin文件夹和一个config文件夹，合并bin文件夹后将两者放到fabric-sample中</p><ul><li>这些二进制文件将帮助您与测试网络进行交互</li></ul></li></ul></li></ul></blockquote><h1 id="sample测试"><a href="#sample测试" class="headerlink" title="sample测试"></a>sample测试</h1><h2 id="运行测试网络"><a href="#运行测试网络" class="headerlink" title="运行测试网络"></a>运行测试网络</h2><h3 id="普通网络"><a href="#普通网络" class="headerlink" title="普通网络"></a>普通网络</h3><p>运行脚本 <code>network.sh</code> 来启动测试网络，该脚本使用本地计算机上的Docker映像站立在Fabric网络上</p><ul><li>到目录 <code>fabric-samples/test-network</code> 下执行命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./network.sh up</span><br></pre></td></tr></table></figure><ul><li>启动网络</li><li>此命令创建一个结构网络，该结构网络由<strong>两个对等节点</strong>，<strong>一个订购节点</strong>组成。您在运行时不会创建任何渠道，如果命令成功完成，您将看到正在创建的节点的日志</li></ul><p>![截屏2021-03-09 下午10.13.09](fabric-Getting Start/截屏2021-03-09 下午10.13.09.png)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./network.sh down</span><br></pre></td></tr></table></figure><ul><li>从以前的任何运行中删除任何容器或工件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                               COMMAND             CREATED              STATUS              PORTS                                            NAMES</span><br><span class="line">fcb443d2c66a   hyperledger/fabric-tools:latest     <span class="string">&quot;/bin/bash&quot;</span>         About a minute ago   Up About a minute                                                    cli</span><br><span class="line">bd07774d282d   hyperledger/fabric-orderer:latest   <span class="string">&quot;orderer&quot;</span>           About a minute ago   Up About a minute   0.0.0.0:7050-&gt;7050/tcp, 0.0.0.0:7053-&gt;7053/tcp   orderer.example.com</span><br><span class="line">5257b92a5b00   hyperledger/fabric-peer:latest      <span class="string">&quot;peer node start&quot;</span>   About a minute ago   Up About a minute   0.0.0.0:7051-&gt;7051/tcp                           peer0.org1.example.com</span><br><span class="line">8a8cd2ea75e4   hyperledger/fabric-peer:latest      <span class="string">&quot;peer node start&quot;</span>   About a minute ago   Up About a minute   7051/tcp, 0.0.0.0:9051-&gt;9051/tcp                 peer0.org2.example.com</span><br></pre></td></tr></table></figure><ul><li>列出计算机上运行的所有Docker容器<ul><li>网络中的每个对等方都必须属于一个组织。在测试网络中，每个组织各自运营一个对等方，<code>peer0.org1.example.com</code> 和 <code>peer0.org2.example.com</code>。</li><li>每个Fabric网络还包括订购服务，可以看到订购节点 <code>orderer.example.com</code>。</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh createChannel -c channelName</span></span><br></pre></td></tr></table></figure><ul><li>创建Channel，系统默认命名为 <code>mychannel</code></li><li>channel名称限制<ul><li>仅包含小写ASCII字母数字，点“。”和破折号“-”</li><li>少于250个字符</li><li>以字母开头</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> deployCC = deploy chaincode</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -ccn <span class="built_in">set</span> chaincode name</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -ccp <span class="built_in">set</span> chaincode path</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -ccl <span class="built_in">set</span> chaincode language</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -c 指定部署链码的通道名称，默认在 mychannel 上部署</span></span><br></pre></td></tr></table></figure><ul><li>在channel上启动链码（此链码将在名为 <code>mychannel</code> 的通道上执行）</li><li>可以在 <code>fabric-sample</code> 的 <code>asset-transfer-basic</code> 文件夹中找到资产转移的示例代码</li><li>第一次部署链码的话，该脚本将安装链码依赖项</li></ul><hr><p><strong>报错</strong></p><ol><li><p>第一次部署时无法下载依赖</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-15 上午10.56.46.png" alt="截屏2021-03-15 上午10.56.46" style="zoom:50%"><ul><li><p>只需要执行两个命令更改GO为国内代理即可，再此执行将成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go env -w GOPROXY=https://goproxy.io,direct</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> go env -w GO111MODULE=on</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><ol start="2"><li><p>无法下载组建 InstallChaincode</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-15 上午11.15.27.png" alt="截屏2021-03-15 上午11.15.27" style="zoom:50%"><ul><li><p>网络问题，重启网络，再重新创建myChannel即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh down</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh up</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh createChannel</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><hr><p><strong>与网络互动，配置peer指令</strong></p><ul><li>均在 <code>test-network</code> 文件夹下执行</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将fabroc-sample/bin下的二进制文件添加到CLI路径中（）</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="variable">$&#123;PWD&#125;</span>/../bin:<span class="variable">$PATH</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置FABRIC_CFG_PATH指向fabric-sample中的core.yaml文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$PWD</span>/../config/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Environment variables <span class="keyword">for</span> Org1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">&quot;Org1MSP&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_ADDRESS=localhost:7051</span></span><br></pre></td></tr></table></figure><ul><li>该 <code>CORE_PEER_TLS_ROOTCERT_FILE</code> 和 <code>CORE_PEER_MSPCONFIGPATH</code> 环境变量指向的ORG1加密材料 <code>organizations</code> 文件夹。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer channel list</span></span><br></pre></td></tr></table></figure><ul><li>列出网络中所有的channel</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span> -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;</span> --peerAddresses localhost:9051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;</span> -c <span class="string">&#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 成功的日志信息</span></span><br><span class="line">2021-03-15 11:30:18.970 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 </span><br></pre></td></tr></table></figure><ul><li>使用资产初始化分类帐</li><li>成功后就可以使用CLI来查询分类账</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode query -C mychannel -n basic -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 成功查询后的输出</span></span><br><span class="line">[</span><br><span class="line">	&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,</span><br><span class="line">  &#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,		</span><br><span class="line">	&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,	</span><br><span class="line">	&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,</span><br><span class="line">	&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,</span><br><span class="line">	&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><ul><li>获取已添加到渠道分类帐中的资产的列表</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem&quot;</span> -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt&quot;</span> --peerAddresses localhost:9051 --tlsRootCertFiles <span class="string">&quot;<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt&quot;</span> -c <span class="string">&#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 成功的日志信息</span></span><br><span class="line">2021-03-15 11:36:04.958 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 </span><br></pre></td></tr></table></figure><ul><li>当网络成员要转移或更改分类帐上的资产时，将调用链码。</li><li>此命令通过调用 <code>asset-transfer-basic</code> 链码来更改分类帐上资产的所有者</li></ul><p>调用链代码后，我们可以使用另一个查询来查看该调用如何更改了区块链分类账上的资产。由于我们已经查询过Org1对等体，因此我们可以借此机会查询Org2对等体上运行的链码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Environment variables <span class="keyword">for</span> Org2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ENABLED=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_LOCALMSPID=<span class="string">&quot;Org2MSP&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_TLS_ROOTCERT_FILE=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_MSPCONFIGPATH=<span class="variable">$&#123;PWD&#125;</span>/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> CORE_PEER_ADDRESS=localhost:9051</span></span><br></pre></td></tr></table></figure><ul><li>设置环境变量以作为Org2进行操作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer chaincode query -C mychannel -n basic -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;ReadAsset&quot;,&quot;asset6&quot;]&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure><ul><li><p>查询运行在 mychannel 上的 <code>asset-transfer-basic</code> 链码 <code>peer0.org2.example.com</code></p></li><li><p>结果显示 <code>&quot;asset6&quot;</code> 已转移到Christopher：</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-15 上午11.39.59.png" alt="截屏2021-03-15 上午11.39.59" style="zoom:50%"></li></ul><h3 id="与证书颁发机构建立网络"><a href="#与证书颁发机构建立网络" class="headerlink" title="与证书颁发机构建立网络"></a>与证书颁发机构建立网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh up -ca</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tree命令并不是默认安装的，如果没有该命令，先安装</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install tree</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 fabric-sample/test-network 下执行</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tree organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/</span></span><br></pre></td></tr></table></figure><ul><li><p>显示MSP文件夹的结构和配置文件：</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-14 下午1.15.18.png" alt="截屏2021-03-14 下午1.15.18" style="zoom:50%"></li></ul><h2 id="运行结构应用程序"><a href="#运行结构应用程序" class="headerlink" title="运行结构应用程序"></a>运行结构应用程序</h2><h3 id="资产转移"><a href="#资产转移" class="headerlink" title="资产转移"></a>资产转移</h3><p><code>asset-transfer-basic</code> 样本演示了如何使用资产初始化分类帐，查询那些资产，创建新资产，基于资产ID查询单个资产，更新现有资产以及将资产转移给新所有者。它涉及以下两个组件：</p><ol><li><p><strong>示例应用程序</strong>：调用区块链网络，调用以链码（智能合约）实现的交易。该应用程序位于以下<code>fabric-samples</code>目录中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asset-transfer-basic&#x2F;application-javascript</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p><strong>智能合约本身</strong>，实现涉及与分类账交互的交易。智能合约（链码）位于以下<code>fabric-samples</code>目录中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asset-transfer-basic&#x2F;chaincode-(javascript, java, go, typescript)</span><br></pre></td></tr></table></figure></li></ol><p>请注意，在本教程中，术语链码和智能合约可互换使用。在此示例中，我们将使用javascript链码。</p><p>主要步骤：</p><ol><li><p><strong>建立开发环境。</strong>我们的应用程序需要与之交互的网络，因此我们将为我们的智能合约和应用程序部署一个基本的网络。<img src="/2021/03/14/fabric-Getting%20Start/AppConceptsOverview.png" alt="AppConceptsOverview" style="zoom:25%"></p></li><li><p><strong>探索样本智能合约。</strong> 我们将检查示例assetTransfer（javascript）智能合约，以了解其中的交易以及应用程序如何使用它们查询和更新分类账。</p></li><li><p><strong>通过示例应用程序与智能合约进行交互。</strong>我们的应用程序将使用assetTransfer智能合约在分类账上创建，查询和更新资产。我们将深入研究应用程序及其创建的交易的代码，包括使用资产初始化分类账，查询资产，查询一系列资产，创建新资产以及将资产转让给新所有者。</p></li></ol><h4 id="启动网络"><a href="#启动网络" class="headerlink" title="启动网络"></a>启动网络</h4><ul><li>根据运行测试网络的步骤</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> open /Applications/Docker.app  <span class="comment"># mac上启动docker desktop的方式</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-samples/test-network</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh down</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh up createChannel -c mychannel -ca</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-javascript/ -ccl javascript</span></span><br></pre></td></tr></table></figure><h4 id="申请样本"><a href="#申请样本" class="headerlink" title="申请样本"></a>申请样本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> PATH=<span class="variable">$&#123;PWD&#125;</span>/../bin:<span class="variable">$PATH</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$PWD</span>/../config/</span></span><br></pre></td></tr></table></figure><ul><li>设置peer指令环境变量</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> fabric-sample/asset-transfer-basic/application-javascript</span></span><br></pre></td></tr></table></figure><ul><li>打开一个新的终端，进入到示例代码文件中，</li><li>该目录包含使用Fabric SDK for Node.js开发的示例程序。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> node app.js</span></span><br></pre></td></tr></table></figure><ul><li><p>运行 npm 命令以安装应用程序依赖项。最多可能需要一分钟才能完成。</p></li><li><p>此过程将安装在的应用程序中定义的关键应用程序依赖项 <code>package.json</code>。其中最重要的是 <code>fabric-network</code> Node.js模块；它使应用程序能够使用身份，钱包和网关来连接到渠道，提交交易并等待通知</p></li><li><p>运行完成后将得到以下文件</p><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-16 上午11.23.37.png" alt="截屏2021-03-16 上午11.23.37" style="zoom:50%"></li></ul><h4 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h4><p><code>fabric-sample/asset-transfer-basic/application-javascript/app.js</code></p><ul><li>仅调用方法<ul><li>方法定义在 <code>fabric-sample/test-application/javascript/</code> 的 <code>CAUtil.js</code> 和 <code>AppUtil.js</code> 中</li></ul></li></ul><h5 id="app-js："><a href="#app-js：" class="headerlink" title="app.js："></a>app.js：</h5><p>当我们启动Fabric测试网络时，创建了一个管理员用户（字面上称为<code>admin</code>）作为证书颁发机构（CA）的<strong>注册商</strong>。</p><img src="/2021/03/14/fabric-Getting%20Start/code.png" alt="截屏2021-03-16 下午3.01.28" style="zoom:50%"><ol><li>调用函数 <code>enrollAdmin()</code> 生成 admin 的私钥，公钥和X.509证书。<ul><li>此过程使用<strong>证书签名请求</strong>（CSR）-专用密钥和公用密钥首先在本地生成，然后将公用密钥发送到CA，CA返回编码的证书供应用程序使用。</li><li>这些凭证然后存储在 <code>application-javascript/wallet</code> 中，使我们能够充当CA的管理员。</li><li>可以在<code>wallet/admin.id</code> 文件中找到管理员的证书和私钥</li></ul></li></ol><blockquote><p><strong>注意</strong></p><p>如果您决定通过断开网络并重新启动来重新开始，则必须<code>wallet</code>在重新运行javascript应用程序之前删除该文件夹及其标识，否则会出现错误。发生这种情况的原因是，在关闭测试网络时，关闭了证书颁发机构及其数据库，但是原始钱包仍保留在application-javascript目录中，因此必须将其删除。当您重新运行示例javascript应用程序时，将生成一个新的钱包和凭据。</p></blockquote><ol start="2"><li>调用 <code>registerAndEnrollUser()</code> 来注册并加入一个应用程序用户 <code>appUser</code>，该用户将用于与区块链网络进行交互<ul><li>与管理员注册类似，此功能使用<strong>CSR</strong>来注册，注册 <code>appUser</code> 和存储其凭据以及<code>admin</code>钱包中的凭据。</li><li>现在，我们拥有两个独立用户的身份，<code>admin</code>并且<code>appUser</code>该身份可以由我们的应用程序使用</li></ul></li></ol><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-16 下午3.20.50.png" alt="截屏2021-03-16 下午3.20.50" style="zoom:50%"><ol start="3"><li><p>应用程序正在通过网关 gateway 使用 <code>chaincodeName</code> 和 <code>channelName</code> 名称来引用合约</p><ul><li><p>（本例是在 mychannel 中使用 asset-transfer-basic 合约）</p></li><li><p>当链码包包含多个智能合约时，可以在<a class="link" target="_blank" rel="noopener" href="https://hyperledger.github.io/fabric-sdk-node/release-2.2/module-fabric-network.Network.html#getContract">getContract（）API<i class="fas fa-external-link-alt"></i></a>上指定链码包的名称和要定位的特定智能合约。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contract = <span class="keyword">await</span> network.getContract(<span class="string">&#x27;chaincodeName&#x27;</span>, <span class="string">&#x27;smartContractName&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>asLocalhost</code> set <code>true</code> 告知它以localhost连接。在不将客户端与其他结构节点在同一网络上运行的部署中，该 <code>asLocalhost</code> 选项将设置为 <code>false</code>。</p></li></ul></li></ol><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-16 下午3.20.58.png" alt="截屏2021-03-16 下午3.20.58" style="zoom:50%"><ol start="4"><li><code>SubmitTransaction()</code> 函数用于调用chaincode的 <code>InitLedger</code> 函数，以使用一些样本数据填充分类帐。<ul><li>在幕后，<code>submitTransaction()</code> 函数将使用服务发现来为链码找到一组所需的认可对等体，在所需数目的对等体上调用链码，从这些对等体收集链码认可的结果，最后将事务提交给订购服务。</li><li>对等体在assets中指定，然后使用 <code>ctx.stub.putState(...)</code> 来验证（chaincode-javascript中）</li></ul></li></ol><img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-16 下午3.45.11.png" alt="截屏2021-03-16 下午3.45.11" style="zoom:50%"> <img src="/2021/03/14/fabric-Getting%20Start/截屏2021-03-16 下午3.35.33.png" alt="截屏2021-03-16 下午3.35.33" style="zoom:50%"><ol start="5"><li></li></ol><blockquote><p>require(‘fabric-network’); 模块中，定义在文件 fabric-network/lib/transaction.js 中</p></blockquote><p><strong>evaluateTransaction()</strong></p><ul><li>代表了区块链网络中与智能合约最简单的交互之一。只是查询账本内容而已</li><li>它只是选择一个在连接配置文件中定义的对等体，然后将请求发送到该对等体，并在此对其进行评估。智能合约查询对等方账本副本上的资产，并将结果返回给应用程序。</li><li>这种交互不会导致分类账的更新。</li></ul><p><strong>submitTransaction()</strong></p><ul><li>比 <code>evaluateTransaction()</code> 复杂得多，是一个完整的共识流程（提交-背书-检验）</li><li>SDK不会与单个peer进行交互，而是根据chaincode的背书政策，向区块链网络中每个需要的组织对等方发送 <code>proposal</code>。这些对等方中的每一个都将使用该 <code>proposal</code> 执行所请求的智能合约，以生成交易响应，该交易响应将对其背书（签署）并返回到SDK。SDK将所有已背书的交易响应收集到一个交易中，然后将其提交给oderer。oderer将来自各种应用程序客户端的交易收集并排序为一个交易块。这些块被分发到网络中的每个对等点，在此对每个事务进行验证和提交。最后，通过事件通知SDK，使其可以将控制权返回给应用程序。</li></ul><h5 id="CAUtil-js"><a href="#CAUtil-js" class="headerlink" title="CAUtil.js"></a>CAUtil.js</h5><p><strong>enrollAdmin</strong></p><p><strong>registerAndEnrollUser</strong></p><ul><li></li></ul><h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><p><a class="link" target="_blank" rel="noopener" href="https://www.jianshu.com/p/248530bf31b8">https://www.jianshu.com/p/248530bf31b8<i class="fas fa-external-link-alt"></i></a></p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>Post title：fabric-Getting Start</li><li>Post author：Wei Jieyang</li><li>Create time：2021-03-14 12:08:44</li><li>Post link：https://jieyang-wei.github.io/2021/03/14/fabric-Getting Start/</li><li>Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2021/03/16/fabric-Developing%20Application/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">fabric-Developing Application</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2021/03/10/go/"><span class="title flex-center"><span class="post-nav-title-item">go</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div></main></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span> - 2021 <i class="fas fa-heart icon-animate"></i> <a href="/">Wei Jieyang</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"><span id="busuanzi_container_site_uv">Visitor Count <span id="busuanzi_value_site_uv"></span>&ensp; </span><span id="busuanzi_container_site_pv">Totalview <span id="busuanzi_value_site_pv"></span></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme <a class="theme-version" target="_blank"></a></div></div></footer></div></div></main><div class="sidebar-tools"><div class="tools-container"><ul class="tools-list"><li class="search popup-trigger"><i class="fas fa-search"></i></li><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="tools-ul-1"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">开发环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%85%E5%A4%87%E8%BD%AF%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">必备软件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Homebrew"><span class="nav-number">2.1.1.</span> <span class="nav-text">Homebrew</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Git"><span class="nav-number">2.1.2.</span> <span class="nav-text">Git</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cURL"><span class="nav-number">2.1.3.</span> <span class="nav-text">cURL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker"><span class="nav-number">2.1.4.</span> <span class="nav-text">Docker</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E9%80%9F"><span class="nav-number">2.1.4.1.</span> <span class="nav-text">加速</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Go"><span class="nav-number">2.1.5.</span> <span class="nav-text">Go</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JQ"><span class="nav-number">2.1.6.</span> <span class="nav-text">JQ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-1"><span class="nav-number">2.1.6.1.</span> <span class="nav-text">问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fabric-sample"><span class="nav-number">2.2.</span> <span class="nav-text">fabric-sample</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-2"><span class="nav-number">2.2.1.</span> <span class="nav-text">问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sample%E6%B5%8B%E8%AF%95"><span class="nav-number">3.</span> <span class="nav-text">sample测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C"><span class="nav-number">3.1.</span> <span class="nav-text">运行测试网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E7%BD%91%E7%BB%9C"><span class="nav-number">3.1.1.</span> <span class="nav-text">普通网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E%E8%AF%81%E4%B9%A6%E9%A2%81%E5%8F%91%E6%9C%BA%E6%9E%84%E5%BB%BA%E7%AB%8B%E7%BD%91%E7%BB%9C"><span class="nav-number">3.1.2.</span> <span class="nav-text">与证书颁发机构建立网络</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">3.2.</span> <span class="nav-text">运行结构应用程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E4%BA%A7%E8%BD%AC%E7%A7%BB"><span class="nav-number">3.2.1.</span> <span class="nav-text">资产转移</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E7%BD%91%E7%BB%9C"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">启动网络</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7%E6%A0%B7%E6%9C%AC"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">申请样本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="nav-number">3.2.1.3.</span> <span class="nav-text">代码解析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#app-js%EF%BC%9A"><span class="nav-number">3.2.1.3.1.</span> <span class="nav-text">app.js：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CAUtil-js"><span class="nav-number">3.2.1.3.2.</span> <span class="nav-text">CAUtil.js</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF"><span class="nav-number">3.3.</span> <span class="nav-text">常见错误</span></a></li></ol></li></ol></div></div></aside><div class="image-viewer-container"><div class="img-box"><img src=""></div></div></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fas fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/code-copy.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/toc.js"></script></body></html>