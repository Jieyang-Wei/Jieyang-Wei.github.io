<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>区块链 | 魏洁杨</title><link rel="shortcut icon" href="/images/logo.svg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"jieyang-wei.github.io",root:"/",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0},style:{primary_color:"#0066CC",avatar:"/images/avatar.jpg",favicon:"/images/logo.svg",img_position:"left",left_side_width:"260px",content_max_width:"900px",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"Welcome to Wei jieyang's Blog"}},local_search:{enable:!0,trigger:"auto",unescape:!1,preload:!0},version:"3.0.4"},KEEP.language={search:"Search...",prev:"Prev",next:"Next",prev_posts:"Prev posts",next_posts:"Next posts",page:"Page %d",recent_posts:"Recent Posts",share:"Share",powered_by:"Powered by %s",theme:"Theme",rss_feed:"RSS Feed",category:"Category",categories:"Categories",tag:"Tag",tags:"Tags",tagcloud:"Tag Cloud",comment:"Comment",home:"Home",archive:"Archive",archives:"Archives",about:"About",site_uv:"Visitor Count",site_pv:"Totalview",links:"Links",link:"Link",top:"TOP",read_more:"Read more",wordcount:"Words",min2read:"Mins",changelog:"Changelog",copyright:{author:"Post author",title:"Post title",link:"Post link",create_time:"Create time",license_title:"Copyright Notice",license_content:"All articles in this blog are licensed under %s unless stating additionally."},ago:{second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days age",week:"%s weeks age",month:"%s months age",year:"%s years age"}}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="WeiJY's blog" type="application/atom+xml"></head><body><div class="page-container"><header class="page-header"><div class="header-progress"></div></header><main class="page-main"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><a class="logo-title" href="/">魏洁杨</a><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/categories">CATEGORIES</a></li><li class="menu-item"><a href="/categories/notebook">NOTEBOOK</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item"><a href="/tags">TAGS</a></li></ul><div class="menu-bar"><div class="menu-bar-middle"></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/categories">CATEGORIES</a></li><li class="drawer-menu-item flex-center"><a href="/categories/notebook">NOTEBOOK</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><main class="main-content normal-code-theme"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">区块链</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.jpg"></div><div class="info"><div class="author"><span>Wei Jieyang</span> <span class="level">Lv2</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-calendar"></i> 2020-12-14 17:47:42 </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i><ul><li><a href="/categories/notebook/">notebook</a></li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i><ul><li><a href="/tags/blockchain/">blockchain</a></li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i> <span>2.9k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i> <span>10 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i> <span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h1 id="区块链"><a href="#区块链" class="headerlink" title="区块链"></a>区块链</h1><ul><li>一个特殊的历史不可更改的链表<strong>数据结构</strong></li><li>一个电子记账本，以比特币和其他密码加密货币进行的交易公开地、按照日期顺序记录其中</li></ul><blockquote><p>总的来说，它是一个公开的数据库，新的数据存储在一个称为区块的容器中，并且附加到一个“不可变”的链条（即区块链）上，链条上还有以前附加的数据。</p><blockquote><p>这里的“不可变”指的是以前的数据一旦附加到链条上，后面是不可更改的。</p></blockquote></blockquote><p>结构：</p><img src="/2020/12/14/%E5%8C%BA%E5%9D%97%E9%93%BE/IMG_DD562F6FCFED-1.jpeg" alt="IMG_DD562F6FCFED-1" style="zoom:50%"><ul><li>genesis block：创世区块</li><li><strong>header</strong><ul><li>256bit：一串随机数nonce，需要使得整个区块信息取hash后值小于target（即前面有多少个0）</li><li>SHA256-1：前一个区块的hash值，创世区块没有前一个区块，所以该值为全0</li><li>SHA256-2：body数据的hash值</li></ul></li><li><strong>body</strong>：存储数据</li></ul><p>区块链大致分为三种类型，但从本质上讲，他们之间并不矛盾，只是使用了不同的技术：</p><ul><li><strong>私有链</strong>可以优先考虑系统的速度，因为它无需像公共区块链那样担心核心故障。理想情况下，将私有链部署在个人或组织可控且信息保密的情况下。</li><li>精心设计的<strong>公有链</strong>在防审计性方面往往更具优势，但代价是速度和吞吐量较低。这些是对交易结算（或智能合约）提供安全性保证的最佳选择。</li><li><strong>联盟链</strong>可减轻私有链中交易对手的风险（通过消除集中控制），并且较少的节点数通常可使它们能够比公共链更有效率的运行。联盟链适合于彼此之间需要相互沟通的单位组织。</li></ul><h1 id="Consensus-Algorithm，共识算法"><a href="#Consensus-Algorithm，共识算法" class="headerlink" title="Consensus Algorithm，共识算法"></a>Consensus Algorithm，共识算法</h1><p>什么是共识？</p><ol><li><strong>点的层面</strong>：多个节点对某个数据达成一致共识。</li><li><strong>线的层面</strong>：即多个节点对多个数据的顺序达成一致共识。<ul><li>这里的<strong>节点</strong>可以是任意的计算机设备，比如pc电脑，笔记本，手机，路由器等，</li><li>这里的<strong>数据</strong>可以是交易数据，状态数据等。</li><li>其中对<strong>数据顺序</strong>达成一致共识是很多共识算法要解决的本质问题。</li></ul></li></ol><p>共识算法是实现共识机制的方法，目前常见的有PoW，PoS，DPoS，PBFT，PAXOS, RAFT等</p><p>主流共识算法可大致分为三类</p><ol><li>挑战证明(Proof of Challenge)<ul><li>简单地说，就是给所有参与者一个有挑战性的问题，谁能在最短的时间内找到答案，那么他就是这轮公认的决策者。</li><li>PoW是一个典型的例子，每个参与者都必须计算一个块的哈希值，这个哈希值需要由N个前导0组成，谁找到了这个哈希值，那新的区块就属于谁。</li></ul></li><li>权益证明(Proof of Stake)<ul><li>简单地说，就是根据参与者所拥有的某种资产或授予的权利，标志在转盘上，然后开始转转盘，转到这对应位置的那个参与者，就是该轮公认的决策者。</li><li>现在的系统，有的根据拥有币的数量，有的根据贡献的储存空间，有的根据积分奖赏的额度等等，千奇百怪。虽然披着不同的羊皮，但他们都是狼，本质都是权益证明。现实生活中，民主选举投票领导人就是这种逻辑，</li><li>但权益证明有一定随机性。</li></ul></li><li>协商证明(Proof of Negotiation)<ul><li>简单地说，就是所有参与者坐在一起，通过多轮对话，协商一个新的决策者。例如PBFT，PAXOS都是属于这种类型，需要多轮交互协议，需要形式化证明协议的可靠性安全性。</li><li>但交互的次数太多引入了复杂性，给网络宽带资源带来了很大负担，这个一个缺点。现实生活中的民主协商制就是这种逻辑。</li><li>为了上述各种类型效率，聪明的人类引入了<strong>代表机制（Delegated）</strong>，不需要所有的参与者都参与最后的决策，而是先选出一些代表，每个代表代理一部分参与者的行使权力，例如DPoS。现实生活中，广大人民群众选出人民代表，召开人民代表大会就是这种逻辑。</li></ul></li></ol><p>也可按照作用区块链的类型分为三类：</p><img src="/2020/12/14/%E5%8C%BA%E5%9D%97%E9%93%BE/截屏2021-01-12 上午1.09.13.png" alt="截屏2021-01-12 上午1.09.13" style="zoom:40%"><ol><li><p><strong>私链</strong>的共识算法即区块链这个概念还没普及时的传统分布式系统里的共识算法</p><ul><li>比如zookeeper的zab协议，就是类paxos算法的一种。私链的适用环境一般是不考虑集群中存在作恶节点，只考虑因为系统或者网络原因导致的<strong>故障节点</strong>。</li></ul></li><li><p><strong>联盟链</strong></p><ul><li><p>经典的代表项目是Hyperledger组织下的Fabric项目，Fabric0.6版本使用的就是pbft算法。</p></li><li><p>适用环境除了需要考虑集群中存在<strong>故障节点</strong>，还需要考虑集群中存在<strong>作恶节点</strong>。</p></li><li><p>对于联盟链，每个新加入的节点都是需要验证和审核的。</p></li></ul></li><li><p><strong>公链</strong></p><ul><li><p>不仅需要考虑网络中存在<strong>故障节点</strong>，还需要考虑<strong>作恶节点</strong>，这一点和联盟链是类似的。</p></li><li><p>但公链中的节点可以很自由的加入或者退出，不需要严格的验证和审核。</p></li></ul></li></ol><h2 id="PoW，工作量证明"><a href="#PoW，工作量证明" class="headerlink" title="PoW，工作量证明"></a>PoW，工作量证明</h2><p>Proof of Work</p><ul><li>最经典的共识机制.。基于给定难度值在最快时间通过迭代计算得到一个随机数 Nonce 以争夺记账权，对获得优先记账权的节点给予一定激励。</li><li>就是大家熟悉的挖矿，通过与或运算，计算出一个满足规则的随机数，即获得本次记账权，发出本轮需要记录的数据，全网其它节点验证后一起存储；<ul><li>优点：完全去中心化，节点自由进出；</li><li>缺点：<ul><li>目前bitcoin已经吸引全球大部分的算力，其它再用Pow共识机制的区块链应用很难获得相同的算力来保障自身的安全；</li><li>挖矿造成大量的资源浪费；</li><li>共识达成的周期较长，不适合商业应用</li></ul></li><li>代表：BTC，Ethereum，莱特币</li></ul></li></ul><h2 id="PoS，权益证明"><a href="#PoS，权益证明" class="headerlink" title="PoS，权益证明"></a>PoS，权益证明</h2><p>Proof of Stake</p><ul><li>通过计算全网节点的持有币量和持币时间（币龄）来决定投票权和打包权。 拥有打包权的节点打包交 易后对全网广播， 拥有投票权的节点投票决定最终上链的区块</li><li>根据每个节点持有币量和持币时间等比例降低计算随机数的难度，从而加快找随机数的速度。<ul><li>优点：在一定程度上缩短了共识达成的时间</li><li>缺点：还是需要挖矿，本质上没有解决商业应用的痛点</li><li>代表： Peercion(点点币) ，Nxt(未来币)</li></ul></li></ul><h2 id="DPoS，委托权益证明"><a href="#DPoS，委托权益证明" class="headerlink" title="DPoS，委托权益证明"></a>DPoS，委托权益证明</h2><p>Delegate Proof of Stake</p><ul><li>是 PoS 的升级版， 由全网普通节点投票选出一些代理节点进行交易验证和记账， 代理节点 完成共识后会获得一定数量的激励， 不合格的代理节点会被投票替换。</li><li>类似于董事会投票，持币者投出一定数量的节点，代理他们进行验证和记账。<ul><li>优点：大幅缩小参与验证和记账节点的数量，可以达到秒级的共识验证</li><li>缺点：整个共识机制还是依赖于代币，很多商业应用是不需要代币存在的</li><li>代表： Bitshare (比特股) ，EOS</li></ul></li></ul><blockquote><p><strong>拜占庭将军问题</strong></p><ul><li>占庭位于如今的土耳其的伊斯坦布尔，是古代东罗马帝国的首都。拜占庭罗马帝国国土辽阔，为了达到防御目的，每块封地都驻扎一支由将军统领的军队，每个军队都分隔很远，将军与将军之间只能靠信差传递消息。 在战争的时候，拜占庭军队内所有将军必需达成一致的共识，决定是否有赢的机会才去攻打敌人的阵营。但是，在军队内有可能存有<strong>叛徒</strong>和敌军的<strong>间谍</strong>，左右将军们的决定影响将军们达成一致共识。</li><li>在已知有将军是叛徒的情况下，其余忠诚的将军如何达成一致协议的问题，这就是拜占庭将军问题。</li><li><strong>前提</strong>：可靠信道<ul><li>如果信道不能保证可靠，那么拜占庭问题无解。</li></ul></li></ul><blockquote><p>关于信道可靠问题，会引出<strong>两军问题</strong>：在一个不可靠的通信链路上试图通过通信以达成一致是基本不可能或者十分困难的。</p></blockquote><p>拜占庭将军问题最早是由Leslie Lamport与另外两人在1982年发表的论文《The Byzantine Generals Problem 》提出的， 他证明了在将军总数大于3f ，背叛者为f 或者更少时，忠诚的将军可以达成命令上的一致，即3f+1&lt;=n。算法复杂度为o（n^(f+1))。</p><p>而Miguel Castro (卡斯特罗)和Barbara Liskov（利斯科夫）在1999年发表的论文《Practical Byzantine Fault Tolerance》中首次提出pbft算法，该算法容错数量也满足3f+1&lt;=n,算法复杂度为o（n^2）。</p></blockquote><h2 id="PBFT，实用拜占庭容错算法"><a href="#PBFT，实用拜占庭容错算法" class="headerlink" title="PBFT，实用拜占庭容错算法"></a>PBFT，实用拜占庭容错算法</h2><p>Practical Byzantine Fault Tolerance</p><ul><li>被广泛使用于联盟链，是一种能容忍全网 1 / 3 节点出现错误或异常的分布式系统共识算法， 该算法依赖节点对同一信息的多次重复确认， 从而达到全网共识。<ul><li>采用三阶段的方式保证了交易的全序<ul><li><strong>pre-prepare</strong>阶段：节点收到pre-prepare消息后，会选择接受或不接受。一个典型情况是消息里的视图编号和请求编号在之前收到的消息里曾经出现过，但是消息的内容却和之前的消息不一样，这时就会拒绝请求。拒绝的原因是主节点不会发送两条有相同编号却有不同内容的消息。</li><li><strong>prepare</strong>阶段：节点向其他节点发送prepare消息。如果节点收到了2f个不同节点的消息，代表该节点的prepare阶段已经完成。</li><li><strong>commit</strong>阶段：节点向其他节点广播commit消息。如果节点收到了2f+1个commit消息（包括自己），代表大多数节点已经进入commit阶段，这一阶段已达成共识。于是节点会执行请求，运行结果。</li></ul></li><li>适用场景：少量节点的政府和大型企业并不需要具备币机制时理想选择</li><li>代表： HyperLedger fabric0.6</li></ul></li></ul><p><strong>详细</strong></p><h2 id="raft"><a href="#raft" class="headerlink" title="raft"></a>raft</h2><p>因为网上已经有大量文章对raft算法进行过详细的介绍，因此这部分只会简单的阐述算法的基本原理和流程。raft算法包含三种角色，分别是：跟随者（follower），候选人（candidate）和领导者（leader）。集群中的一个节点在某一时刻只能是这三种状态的其中一种，这三种角色是可以随着时间和条件的变化而互相转换的。</p><p>raft算法主要有两个过程：一个过程是领导者选举，另一个过程是日志复制，其中日志复制过程会分记录日志和提交数据两个阶段。raft算法支持最大的容错故障节点是（N-1）/2，其中N为 集群中总的节点数量。</p><h1 id="Smart-Contract，智能合约"><a href="#Smart-Contract，智能合约" class="headerlink" title="Smart Contract，智能合约"></a>Smart Contract，智能合约</h1></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>Post title：区块链</li><li>Post author：Wei Jieyang</li><li>Create time：2020-12-14 17:47:42</li><li>Post link：https://jieyang-wei.github.io/2020/12/14/区块链/</li><li>Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2020/12/14/gdb%E8%B0%83%E8%AF%95/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">gdb调试</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2020/12/14/%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86/"><span class="title flex-center"><span class="post-nav-title-item">版本管理</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div></main></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span> - 2021 <i class="fas fa-heart icon-animate"></i> <a href="/">Wei Jieyang</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"><span id="busuanzi_container_site_uv">Visitor Count <span id="busuanzi_value_site_uv"></span>&ensp; </span><span id="busuanzi_container_site_pv">Totalview <span id="busuanzi_value_site_pv"></span></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme <a class="theme-version" target="_blank"></a></div></div></footer></div></div></main><div class="sidebar-tools"><div class="tools-container"><ul class="tools-list"><li class="search popup-trigger"><i class="fas fa-search"></i></li><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="tools-ul-1"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><aside class="page-aside"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="nav-number">1.</span> <span class="nav-text">区块链</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Consensus-Algorithm%EF%BC%8C%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">Consensus Algorithm，共识算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PoW%EF%BC%8C%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E"><span class="nav-number">2.1.</span> <span class="nav-text">PoW，工作量证明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PoS%EF%BC%8C%E6%9D%83%E7%9B%8A%E8%AF%81%E6%98%8E"><span class="nav-number">2.2.</span> <span class="nav-text">PoS，权益证明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DPoS%EF%BC%8C%E5%A7%94%E6%89%98%E6%9D%83%E7%9B%8A%E8%AF%81%E6%98%8E"><span class="nav-number">2.3.</span> <span class="nav-text">DPoS，委托权益证明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PBFT%EF%BC%8C%E5%AE%9E%E7%94%A8%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%AE%B9%E9%94%99%E7%AE%97%E6%B3%95"><span class="nav-number">2.4.</span> <span class="nav-text">PBFT，实用拜占庭容错算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#raft"><span class="nav-number">2.5.</span> <span class="nav-text">raft</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Smart-Contract%EF%BC%8C%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="nav-number">3.</span> <span class="nav-text">Smart Contract，智能合约</span></a></li></ol></div></div></aside><div class="image-viewer-container"><div class="img-box"><img src=""></div></div></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fas fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/code-copy.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/toc.js"></script></body></html>